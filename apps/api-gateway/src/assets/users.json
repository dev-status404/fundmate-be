{
  "openapi": "3.0.4",
  "info": {
    "title": "User Service API",
    "version": "1.0.0",
    "description": "사용자 관리 기능(목록 조회·생성·조회·수정·회원 탈퇴)을 제공하는 마이크로서비스입니다."
  },
  "servers": [
    {
      "url": "https://fundmate.store/api/users",
      "description": "Production 서버"
    }
  ],
  "tags": [
    {
      "name": "users",
      "description": "사용자 관련 API"
    }
  ],
  "paths": {
    "/": {
      "get": {
        "tags": ["users"],
        "summary": "사용자 목록 조회",
        "description": "페이지네이션을 지원합니다.",
        "security": [{ "bearerAuth": [] }],
        "parameters": [{ "$ref": "#/components/parameters/page" }, { "$ref": "#/components/parameters/pageSize" }],
        "responses": {
          "200": {
            "description": "사용자 배열 반환 성공",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/User" }
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      },
      "post": {
        "tags": ["users"],
        "summary": "사용자 생성",
        "description": "새 사용자를 등록합니다.",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UserRequest" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "사용자 생성 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/User" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/{user_id}": {
      "get": {
        "tags": ["users"],
        "summary": "특정 사용자 조회",
        "description": "path 파라미터 user_id 에 해당하는 사용자를 반환합니다.",
        "security": [{ "bearerAuth": [] }],
        "parameters": [{ "$ref": "#/components/parameters/userId" }],
        "responses": {
          "200": {
            "description": "단일 사용자 반환 성공",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/User" }
              }
            }
          },
          "404": { "$ref": "#/components/responses/NotFound" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      },
      "put": {
        "tags": ["users"],
        "summary": "사용자 정보 수정",
        "description": "path 파라미터 user_id 에 해당하는 사용자의 정보를 업데이트합니다.",
        "security": [{ "bearerAuth": [] }],
        "parameters": [{ "$ref": "#/components/parameters/userId" }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UserRequest" }
            }
          }
        },
        "responses": {
          "200": { "description": "업데이트 성공" },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "404": { "$ref": "#/components/responses/NotFound" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      },
      "delete": {
        "tags": ["users"],
        "summary": "관리자용 사용자 삭제",
        "description": "path 파라미터 user_id 에 해당하는 사용자를 삭제합니다.",
        "security": [{ "bearerAuth": [] }],
        "parameters": [{ "$ref": "#/components/parameters/userId" }],
        "responses": {
          "204": { "description": "삭제 성공 (응답 본문 없음)" },
          "404": { "$ref": "#/components/responses/NotFound" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/account": {
      "delete": {
        "tags": ["users"],
        "summary": "회원 탈퇴",
        "description": "본인 계정을 비밀번호 확인 후 탈퇴 처리합니다.",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AccountDeleteRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "회원 탈퇴 성공",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "회원 탈퇴 성공" }
                  }
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "parameters": {
      "page": {
        "name": "page",
        "in": "query",
        "description": "페이지 번호 (1부터 시작)",
        "schema": { "type": "integer", "minimum": 1, "default": 1 }
      },
      "pageSize": {
        "name": "pageSize",
        "in": "query",
        "description": "한 페이지당 항목 수",
        "schema": { "type": "integer", "minimum": 1, "maximum": 100, "default": 20 }
      },
      "userId": {
        "name": "user_id",
        "in": "path",
        "description": "사용자 고유 ID",
        "required": true,
        "schema": { "type": "integer" }
      }
    },
    "responses": {
      "BadRequest": {
        "description": "잘못된 요청",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "Unauthorized": {
        "description": "인증 실패 (토큰 없음 또는 만료)",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "NotFound": {
        "description": "리소스 없음",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "InternalError": {
        "description": "서버 내부 오류",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      }
    },
    "schemas": {
      "UserRequest": {
        "type": "object",
        "required": ["nickname", "email"],
        "properties": {
          "age_id": { "type": "integer", "example": 3 },
          "image_id": { "type": "integer", "example": 12 },
          "nickname": { "type": "string", "example": "jisung" },
          "email": { "type": "string", "format": "email", "example": "user@example.com" },
          "password": { "type": "string", "format": "password", "example": "P@ssw0rd!" },
          "contents": { "type": "string", "description": "자기소개", "example": "안녕하세요!" },
          "gender": { "type": "string", "enum": ["male", "female", "any"], "example": "any" },
          "provider": { "type": "string", "example": "google" },
          "sns_id": { "type": "string", "example": "1234567890" }
        }
      },
      "User": {
        "allOf": [
          { "$ref": "#/components/schemas/UserRequest" },
          {
            "type": "object",
            "properties": { "user_id": { "type": "integer", "example": 42 } }
          }
        ]
      },
      "AccountDeleteRequest": {
        "type": "object",
        "required": ["password"],
        "properties": {
          "password": { "type": "string", "format": "password", "example": "zzz111" }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "code": { "type": "string", "example": "INVALID_INPUT" },
          "message": { "type": "string", "example": "필수 필드가 누락되었습니다." }
        }
      }
    }
  },
  "security": [{ "bearerAuth": [] }]
}
